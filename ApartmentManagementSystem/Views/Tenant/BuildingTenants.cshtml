@model IEnumerable<ApartmentManagementSystem.Models.Tenant>

@{
    ViewData["Title"] = "Building Tenants";
}

<div class="mb-4">
    <h3><strong>Tenants in @ViewData["BuildingName"]</strong></h3>
    <p class="text-muted text-sm">This view shows all tenants currently residing in your building across all flats</p>
</div>

<table id="buildingTenantsTable" class="table table-striped table-bordered" style="width:100%">
    <thead>
        <tr>
            <th>Flat Number</th>
            <th>Tenant Name</th>
            <th>Email</th>
            <th>Phone Number</th>
            <th>Flat Owner</th>
            <th>Status</th>
            <th>Actions</th>
        </tr>
    </thead>
    <tbody>
        @foreach (var tenant in Model)
        {
            <tr>
                <td>
                    <span class="badge badge-primary">@tenant.Flat?.FlatNumber</span>
                </td>
                <td>@tenant.Fullname</td>
                <td>
                    @if (!string.IsNullOrEmpty(tenant.Email))
                    {
                        <a href="mailto:@tenant.Email">@tenant.Email</a>
                    }
                    else
                    {
                        <span class="text-muted">Not provided</span>
                    }
                </td>
                <td>
                    @if (!string.IsNullOrEmpty(tenant.PhoneNumber))
                    {
                        <a href="tel:@tenant.PhoneNumber">@tenant.PhoneNumber</a>
                    }
                    else
                    {
                        <span class="text-muted">Not provided</span>
                    }
                </td>
                <td>
                    @if (tenant.Flat?.Owner != null)
                    {
                        @tenant.Flat.Owner.Fullname
                    }
                    else
                    {
                        <span class="text-muted">No owner assigned</span>
                    }
                </td>
                <td>
                    @if (tenant.IsActive)
                    {
                        <span class="badge badge-success">Active</span>
                    }
                    else
                    {
                        <span class="badge badge-secondary">Inactive</span>
                    }
                </td>
                <td>
                    <div class="btn-group" role="group">
                        <a asp-action="Details" asp-route-id="@tenant.Id" class="btn btn-info btn-sm" title="View Details">
                            <i class="fas fa-eye"></i> Details
                        </a>
                        <a asp-action="ViewTenants" asp-route-flatId="@tenant.FlatId" class="btn btn-secondary btn-sm" title="View All Tenants in this Flat">
                            <i class="fas fa-users"></i> Flat Tenants
                        </a>
                        <a asp-controller="Rent" asp-action="Index" asp-route-tenantId="@tenant.Id" class="btn btn-success btn-sm" title="View Rent Payments">
                            <i class="fas fa-money-bill-wave"></i> Rent
                        </a>
                    </div>
                </td>
            </tr>
        }
    </tbody>
</table>

@if (!Model.Any())
{
    <div class="alert alert-warning text-center">
        <i class="fas fa-exclamation-triangle"></i>
        <h4>No Tenants Found</h4>
        <p>There are currently no tenants registered in this building.</p>
    </div>
}

@section Scripts {

    <!-- DataTables CSS -->
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.13.7/css/dataTables.bootstrap5.min.css">

    <!-- DataTables JavaScript -->
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.7/js/jquery.dataTables.min.js"></script>
    <script type="text/javascript" src="https://cdn.datatables.net/1.13.7/js/dataTables.bootstrap5.min.js"></script>

    <script>
        $(document).ready(function() {
            $('#buildingTenantsTable').DataTable({
                "responsive": true,
                "pageLength": 15,
                "lengthMenu": [[15, 25, 50, -1], [15, 25, 50, "All"]],
                "order": [[0, "asc"]], // Order by Flat Number ascending by default
                "columnDefs": [
                    {
                        "targets": [0], // Flat Number column
                        "type": "string"
                    },
                    {
                        "targets": [5], // Status column
                        "orderable": true,
                        "searchable": true
                    },
                    {
                        "targets": [6], // Actions column
                        "orderable": false,
                        "searchable": false
                    }
                ],
                "language": {
                    "search": "Search Tenants:",
                    "lengthMenu": "Show _MENU_ tenants per page",
                    "info": "Showing _START_ to _END_ of _TOTAL_ tenants",
                    "infoEmpty": "No tenants available",
                    "infoFiltered": "(filtered from _MAX_ total tenants)",
                    "paginate": {
                        "first": "First",
                        "last": "Last",
                        "next": "Next",
                        "previous": "Previous"
                    },
                    "emptyTable": "No tenants found in this building"
                },
                "dom": '<"row"<"col-sm-12 col-md-6"l><"col-sm-12 col-md-6"f>>' +
                       '<"row"<"col-sm-12"tr>>' +
                       '<"row"<"col-sm-12 col-md-5"i><"col-sm-12 col-md-7"p>>'
            });
        });
    </script>

    <style>
        .badge-primary {
            background-color: #007bff;
            color: white;
            padding: 0.375rem 0.75rem;
            border-radius: 0.375rem;
        }

        .badge-success {
            background-color: #28a745;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .badge-secondary {
            background-color: #6c757d;
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 0.25rem;
        }

        .btn-group .btn {
            margin-right: 2px;
        }

            .btn-group .btn:last-child {
                margin-right: 0;
            }
    </style>
}